version: "3.9"

services:
  # -----------------------------------
  # PX4â€¯SITLâ€¯+â€¯IgnitionÂ Gazebo simulator
  # -----------------------------------
  px4-simulator:
    build:
      context: ./docker/px4-simulator
      dockerfile: Dockerfile.simulator
    container_name: px4-simulator
    environment:
      - HEADLESS=${HEADLESS:-1}
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
    ports:
      - "14556:14556/udp"
      - "11345:11345/udp"
    volumes:
      - ./logs:/work/logs
      - ./custom_model:/work/custom_model:ro
      - ./custom_airframes:/work/custom_airframes:ro

  # --------------------------
  # ROSÂ 2  â†”ï¸  PX4Â SITL bridge
  # --------------------------
  px4-bridge:
    # ğŸ”„ ã“ã“ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«å¤‰æ›´
    build:
      context: .                                   # â† ãƒªãƒã‚¸ãƒˆãƒªå…¨ä½“ã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«
      dockerfile: docker/px4-bridge/Dockerfile.bridge
    depends_on:
      - px4-simulator
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}

  # --------------------
  # RL ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç’°å¢ƒ
  # --------------------
  rl-agent:
    build:
      context: ./docker/rl-agent
      dockerfile: Dockerfile.agent
    depends_on:
      - px4-bridge
    environment:
      - ROS_DOMAIN_ID=${ROS_DOMAIN_ID:-0}
    volumes:
      - ./logs:/work/logs
